<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Banjara Bazaar - Seller Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #fefce8; }
        .hidden { display: none; }
        .form-input { border: 1px solid #d1d5db; border-radius: 0.5rem; padding: 0.75rem; width: 100%; transition: all 0.2s; }
        .form-input:focus { border-color: #facc15; box-shadow: 0 0 0 3px rgba(250, 204, 21, 0.4); outline: none; }
        .wizard-container { background-color: #fff; border-radius: 1.5rem; box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1); width: 100%; max-width: 56rem; padding: 2rem; transition: all 0.3s ease-in-out; }
        .wizard-progress-bar { display: flex; align-items: center; margin-bottom: 2rem; padding-bottom: 1.5rem; border-bottom: 1px solid #e5e7eb; }
        .wizard-progress-step { flex: 1; text-align: center; color: #6b7280; font-weight: 600; position: relative; }
        .wizard-progress-dot { height: 2rem; width: 2rem; margin: 0 auto; border-radius: 9999px; border: 2px solid #e5e7eb; background-color: #fff; color: #6b7280; display: flex; align-items: center; justify-content: center; transition: all 0.3s; position: relative; z-index: 2; font-weight: 700; }
        .wizard-progress-step.active .wizard-progress-dot, .wizard-progress-step.completed .wizard-progress-dot { border-color: #f59e0b; background-color: #f59e0b; color: white; transform: scale(1.1); }
        .wizard-progress-label { margin-top: 0.75rem; font-size: 0.8rem; }
        .wizard-progress-line { position: absolute; height: 2px; width: 100%; background: #e5e7eb; top: 1rem; transform: translateY(-50%); left: -50%; z-index: 1; }
        .wizard-progress-step:first-child .wizard-progress-line { display: none; }
        .wizard-progress-step.completed .wizard-progress-line { background: #f59e0b; }
        .upload-slot { position: relative; width: 100%; aspect-ratio: 1 / 1; border: 2px dashed #d1d5db; border-radius: 0.5rem; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #a0aec0; cursor: pointer; background-color: #f7fafc; overflow: hidden; }
        .upload-slot:hover { border-color: #facc15; }
        .upload-slot img { width: 100%; height: 100%; object-fit: cover; }
        .mrp-example { color: #6b7280; font-size: 0.8rem; margin-top: -0.5rem; padding-left: 0.25rem; }
        .mrp-example .strike { text-decoration: line-through; color: #ef4444; }
        .mrp-example .final-price { color: #16a34a; font-weight: 600; }
        .ai-suggestion-box { background-color: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 0.5rem; padding: 0.75rem; margin-top: 1rem; display: flex; align-items: center; }
        .review-section { margin-bottom: 1.5rem; }
        .review-label { font-weight: 600; color: #4b5563; }
        .review-value { color: #1f2937; }
        details > summary { list-style: none; cursor: pointer; font-weight: 600; font-size: 1.125rem; padding: 1rem; border: 1px solid #e5e7eb; border-radius: 0.5rem; display: flex; justify-content: space-between; align-items: center;}
        details > summary::-webkit-details-marker { display: none; }
        details[open] > summary { border-bottom-left-radius: 0; border-bottom-right-radius: 0; }
        details .details-content { padding: 1.5rem; border: 1px solid #e5e7eb; border-top: 0; border-bottom-left-radius: 0.5rem; border-bottom-right-radius: 0.5rem; }
        details > summary .arrow { transition: transform 0.2s; }
        details[open] > summary .arrow { transform: rotate(180deg); }
        .tooltip { position: relative; display: inline-block; }
        .tooltip .tooltiptext { visibility: hidden; width: 220px; background-color: #333; color: #fff; text-align: center; border-radius: 6px; padding: 8px; position: absolute; z-index: 1; bottom: 125%; left: 50%; margin-left: -110px; opacity: 0; transition: opacity 0.3s; font-size: 0.8rem; font-weight: 500;}
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }
        .voice-input-container { position: relative; width: 100%; }
        .voice-input-container textarea { padding-right: 2.5rem; }
        .voice-input-icon { position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); cursor: pointer; color: #6b7280; }
        .voice-input-icon:hover { color: #1f2937; }
    </style>
</head>
<body>
    <div id="app-container">
        <div id="view-product-wizard">
             <div class="min-h-screen flex items-center justify-center px-4 py-12 bg-yellow-100">
                <div class="wizard-container">
                    <div id="wizard-steps-wrapper">
                        <div class="wizard-progress-bar">
                            <div id="wp-step-1" class="wizard-progress-step"><div class="wizard-progress-dot">1</div><p class="wizard-progress-label">Images</p></div>
                            <div id="wp-step-2" class="wizard-progress-step"><div class="wizard-progress-dot">2<div class="wizard-progress-line"></div></div><p class="wizard-progress-label">AI Polish</p></div>
                            <div id="wp-step-3" class="wizard-progress-step"><div class="wizard-progress-dot">3<div class="wizard-progress-line"></div></div><p class="wizard-progress-label">Details</p></div>
                            <div id="wp-step-4" class="wizard-progress-step"><div class="wizard-progress-dot">4<div class="wizard-progress-line"></div></div><p class="wizard-progress-label">Pricing</p></div>
                            <div id="wp-step-5" class="wizard-progress-step"><div class="wizard-progress-dot">5<div class="wizard-progress-line"></div></div><p class="wizard-progress-label">Review</p></div>
                        </div>

                        <div id="wizard-step-1-content">
                            <h2 class="text-3xl font-bold text-center mb-2">List a New Product</h2>
                            <p class="text-center text-gray-600 mb-6">Start by uploading 4 clear photos of your product.</p>
                            <div class="flex justify-center gap-4 mb-6 text-xs text-center">
                                <div><img src="https://i.imgur.com/Uf24T4N.png" class="w-20 h-20 rounded border-2 border-green-400"><span class="font-semibold text-green-600">✓ Correct</span></div>
                                <div><img src="https://i.imgur.com/uTyA1u3.png" class="w-20 h-20 rounded border-2 border-red-400"><span class="font-semibold text-red-600">✗ Incorrect</span></div>
                            </div>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="image-upload-slots"></div>
                            <input id="file-upload-wizard" type="file" class="hidden" accept="image/*" multiple>
                            <p id="wizard-upload-status" class="text-center text-sm font-semibold mt-4 h-5 text-red-600"></p>
                            <div class="mt-8 pt-6 border-t flex justify-end"><button id="wizard-step1-next" class="bg-yellow-400 hover:bg-yellow-500 text-black font-semibold py-2 px-5 rounded-lg shadow disabled:bg-gray-300" disabled>Next →</button></div>
                        </div>
                        
                        <div id="wizard-step-2-content" class="hidden">
                            <div id="ai-image-loader" class="text-center py-12"><div role="status"><svg aria-hidden="true" class="inline w-10 h-10 text-gray-200 animate-spin fill-yellow-400" viewBox="0 0 100 101" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z" fill="currentColor"/><path d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0492C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5424 39.6781 93.9676 39.0409Z" fill="currentColor"/></svg></div><h2 class="text-2xl font-bold text-center mt-4">Our AI is polishing your images and generating details... ✨</h2><p class="text-center text-gray-600">Please wait, this might take a moment.</p></div>
                            <div id="ai-image-results" class="hidden"><h2 class="text-3xl font-bold text-center mb-2">Approve Enhanced Image (For Demo Only)</h2><p class="text-center text-gray-600 mb-8">We've processed your primary image. Please approve to continue. (Visual polishing is for demo, actual details are generated)</p><div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center"><div class="text-center"><h4 class="font-bold mb-2">Before</h4><img id="image-before" src="" class="rounded-lg shadow-md w-full"></div><div class="text-center"><h4 class="font-bold mb-2">After (AI Processed)</h4><img id="image-after" src="" class="rounded-lg shadow-md w-full"></div></div><div class="mt-6 text-center"><label class="inline-flex items-center"><input id="approve-images-check" type="checkbox" class="h-5 w-5 rounded border-gray-300 text-yellow-600 focus:ring-yellow-500"><span class="ml-2 text-gray-700 font-semibold">I approve the processed images.</span></label></div><div class="mt-8 pt-6 border-t flex justify-between"><button id="wizard-step2-back" class="bg-gray-200 hover:bg-gray-300 font-semibold py-2 px-5 rounded-lg">← Back</button><button id="wizard-step2-next" class="bg-yellow-400 hover:bg-yellow-500 text-black font-semibold py-2 px-5 rounded-lg shadow disabled:bg-gray-300" disabled>Next →</button></div></div>
                        </div>
                        
                        <div id="wizard-step-3-content" class="hidden">
                             <h2 class="text-3xl font-bold text-center mb-2">Product Details</h2><p class="text-center text-gray-600 mb-8">Review the AI-generated details and add specifics.</p>
                             <form id="detailsForm" class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div><label class="font-medium" for="title">Product Title <span class="text-red-500">*</span></label><input type="text" id="title" required class="form-input mt-1"></div>
                                    <div><label class="font-medium" for="category">Category <span class="text-red-500">*</span></label><select id="category" required class="form-input mt-1 bg-white"><option value="">Select Category</option><option>Home Decor</option><option>Furniture</option><option>Kitchenware</option></select></div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div><label class="font-medium" for="description">Product Description <span class="text-red-500">*</span></label><textarea id="description" rows="3" required class="form-input mt-1" placeholder="Describe the product in detail..."></textarea></div>
                                    <div>
                                        <label class="font-medium" for="features">Key Features (1 per line) <span class="text-red-500">*</span></label>
                                        <div class="voice-input-container mt-1">
                                            <textarea id="features" rows="3" required class="form-input" placeholder="Feature 1&#10;Feature 2&#10;Feature 3"></textarea>
                                            <div class="voice-input-icon" onclick="alert('Voice-to-Text feature will be activated here!')">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div><label class="font-medium" for="size-variants">Size Variants? (comma-separated)</label><input type="text" id="size-variants" class="form-input mt-1" placeholder="e.g., Small, Medium, Large"></div>
                                    <div><label class="font-medium" for="keywords">Search Keywords (comma-separated) <span class="text-red-500">*</span></label><input type="text" id="keywords" required class="form-input mt-1" placeholder="e.g., wooden tray, serving platter"></div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div><label class="font-medium" for="material">Material <span class="text-red-500">*</span></label><input type="text" id="material" required class="form-input mt-1" placeholder="e.g., Mango Wood"></div>
                                    <div><label class="font-medium" for="color">Color Variant <span class="text-red-500">*</span></label><input type="text" id="color" required class="form-input mt-1" placeholder="e.g., Natural Brown"></div>
                                    <div>
                                        <label class="font-medium flex items-center" for="hsn-code">HSN Code <span class="text-red-500">*</span>
                                            <div class="tooltip ml-2">
                                                <span class="bg-gray-200 text-gray-600 rounded-full h-4 w-4 flex items-center justify-center text-xs font-bold">?</span>
                                                <span class="tooltiptext">HSN code is a 6-digit code for classifying goods for GST purposes. If unsure, search online for your product category.</span>
                                            </div>
                                        </label>
                                        <input type="text" id="hsn-code" required class="form-input mt-1" placeholder="6 or 8-digit code">
                                    </div>
                                </div>
                                <div class="mt-8 pt-6 border-t flex justify-between"><button type="button" id="wizard-step3-back" class="bg-gray-200 hover:bg-gray-300 font-semibold py-2 px-5 rounded-lg">← Back</button><button type="submit" class="bg-yellow-400 hover:bg-yellow-500 text-black font-semibold py-2 px-5 rounded-lg shadow">Next →</button></div>
                            </form>
                        </div>

                        <div id="wizard-step-4-content" class="hidden">
                             <h2 class="text-3xl font-bold text-center mb-2">Pricing & Policies</h2><p class="text-center text-gray-600 mb-8">Set your price, stock, and policies.</p>
                             <form id="pricingForm" class="space-y-6">
                                <div class="border p-4 rounded-lg bg-yellow-50">
                                    <h3 class="font-semibold text-lg mb-4">Individual Pricing <span class="text-red-500">*</span></h3>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                                        <div><label class="font-medium" for="mrp">MRP (₹) <span class="text-red-500">*</span></label><input type="number" id="mrp" required class="form-input mt-1" placeholder="e.g., 2999"></div>
                                        <div><label class="font-medium" for="sellingPrice">Your Selling Price (₹) <span class="text-red-500">*</span></label><input type="number" id="sellingPrice" required class="form-input mt-1" placeholder="e.g., 1499"></div>
                                    </div>
                                    <div class="mrp-example mt-2" id="mrp-example-text"></div>
                                    <div class="ai-suggestion-box">
                                        <span class="text-2xl mr-3">💡</span>
                                        <div><p class="font-semibold text-green-800">AI Price Suggestion</p><p class="text-sm text-green-700">To be competitive, we suggest a price around **₹1499**.</p></div>
                                    </div>
                                </div>
                                <details id="group-buy-details" class="space-y-4">
                                    <summary>Group Buy Pricing (Optional)<span class="arrow">▼</span></summary>
                                    <div class="details-content space-y-4">
                                        <label class="flex items-center"><input type="checkbox" id="enable-group-buy" class="h-4 w-4 rounded"><span class="ml-2">Enable Group Buy for this product</span></label>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div><label class="font-medium" for="group-buy-price">Group Buy Price (per item)</label><input type="number" id="group-buy-price" class="form-input mt-1" placeholder="e.g. 1299"></div>
                                            <div><label class="font-medium" for="group-buy-moq">Group Buy MOQ</label><input type="number" id="group-buy-moq" class="form-input mt-1" placeholder="e.g., 5"></div>
                                        </div>
                                    </div>
                                </details>
                                <details id="wholesale-details" class="space-y-4">
                                    <summary>Wholesale Pricing (Optional)<span class="arrow">▼</span></summary>
                                    <div class="details-content space-y-4">
                                        <label class="flex items-center"><input type="checkbox" id="enable-wholesale" class="h-4 w-4 rounded"><span class="ml-2">Enable Wholesale for this product</span></label>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div><label class="font-medium" for="wholesale-price">Wholesale Price (per item)</label><input type="number" id="wholesale-price" class="form-input mt-1" placeholder="e.g. 999"></div>
                                            <div><label class="font-medium" for="wholesale-moq">Wholesale MOQ</label><input type="number" id="wholesale-moq" class="form-input mt-1" placeholder="e.g., 20"></div>
                                        </div>
                                    </div>
                                </details>
                                <details id="inventory-details" class="space-y-4" open>
                                    <summary>Inventory & Policies <span class="text-red-500">*</span></summary>
                                    <div class="details-content space-y-4">
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div><label class="font-medium" for="product-weight">Product Weight (in KG) <span class="text-red-500">*</span></label><input type="text" id="product-weight" required class="form-input mt-1" placeholder="e.g., 1.6"></div>
                                            <div><label class="font-medium" for="package-weight">Package Weight (in KG) <span class="text-red-500">*</span></label><input type="text" id="package-weight" required class="form-input mt-1" placeholder="e.g., 1.8"></div>
                                        </div>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <label class="font-medium flex items-center" for="package-dimensions-length">Package Dimensions <span class="text-red-500">*</span>
                                                    <div class="tooltip ml-2">
                                                        <span class="bg-gray-200 text-gray-600 rounded-full h-4 w-4 flex items-center justify-center text-xs font-bold">?</span>
                                                        <span class="tooltiptext">Provide the dimensions of the package. This is used to calculate shipping costs.</span>
                                                    </div>
                                                </label>
                                                <div class="mt-1 grid grid-cols-3 gap-4">
                                                    <input type="text" id="package-dimensions-length" required class="form-input" placeholder="Length (L)">
                                                    <input type="text" id="package-dimensions-breadth" required class="form-input" placeholder="Breadth (B)">
                                                    <input type="text" id="package-dimensions-height" required class="form-input" placeholder="Height (H)">
                                                </div>
                                                <div class="mt-1 flex justify-end">
                                                    <select id="package-dimensions-unit" class="form-input w-20 bg-white">
                                                        <option>cm</option>
                                                        <option>inch</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div>
                                                <label class="font-medium" for="package-items">Package Items <span class="text-red-500">*</span></label>
                                                <select id="package-items" required class="form-input mt-1 bg-white">
                                                    <option value="" disabled selected>Select an option</option>
                                                    <option value="Single Piece">Single Piece</option>
                                                    <option value="Set of 1">Set of 1</option>
                                                    <option value="Set of 2">Set of 2</option>
                                                    <option value="Set of 3">Set of 3</option>
                                                    <option value="Set of 4">Set of 4</option>
                                                    <option value="Set of 5">Set of 5</option>
                                                    <option value="Whole Set">Whole Set</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div><label class="font-medium" for="stock">Total Stock Quantity <span class="text-red-500">*</span></label><input type="number" id="stock" required class="form-input mt-1" placeholder="e.g., 100"></div>
                                            <div>
                                                <label class="font-medium" for="return-policy">Return Policy <span class="text-red-500">*</span></label>
                                                <select id="return-policy" required class="form-input mt-1 bg-white">
                                                    <option value="" disabled selected>Select a policy</option>
                                                    <option value="non-returnable">Non-Returnable</option>
                                                    <option value="7-day-defect-only">7-Day Return (Defects Only)</option>
                                                    <option value="10-day-exchange">10-Day Exchange</option>
                                                    <option value="15-day-full-refund">15-Day Full Refund</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </details>
                                <div class="mt-8 pt-6 border-t flex justify-between"><button type="button" id="wizard-step4-back" class="bg-gray-200 hover:bg-gray-300 font-semibold py-2 px-5 rounded-lg">← Back</button><button type="submit" class="bg-yellow-400 hover:bg-yellow-500 text-black font-semibold py-2 px-5 rounded-lg shadow">Next →</button></div>
                            </form>
                        </div>
                        
                        <div id="wizard-step-5-content" class="hidden">
                             <h2 class="text-3xl font-bold text-center mb-2">Review & Submit</h2><p class="text-center text-gray-600 mb-8">Please review all details before submitting your product.</p>
                             <div class="space-y-6">
                                <div class="review-section"><h3 class="text-lg font-semibold border-b pb-2 mb-3">Product Images</h3><div id="review-images" class="grid grid-cols-4 gap-4"></div></div>
                                <div class="review-section"><h3 class="text-lg font-semibold border-b pb-2 mb-3">Product Details</h3><div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-2 text-sm">
                                    <div><span class="review-label">Title:</span> <span id="review-title" class="review-value"></span></div>
                                    <div><span class="review-label">Category:</span> <span id="review-category" class="review-value"></span></div>
                                    <div><span class="review-label">Description:</span> <span id="review-description" class="review-value"></span></div>
                                    <div><span class="review-label">Material:</span> <span id="review-material" class="review-value"></span></div>
                                    <div><span class="review-label">Color:</span> <span id="review-color" class="review-value"></span></div>
                                    <div><span class="review-label">HSN Code:</span> <span id="review-hsn-code" class="review-value"></span></div>
                                    <div><span class="review-label">Size Variants:</span> <span id="review-size-variants" class="review-value"></span></div>
                                </div><div class="mt-2"><span class="review-label">Keywords:</span> <span id="review-keywords" class="review-value text-sm"></span></div><div class="mt-2"><span class="review-label">Key Features:</span><ul id="review-features" class="list-disc list-inside review-value text-sm"></ul></div></div>
                                <div class="review-section"><h3 class="text-lg font-semibold border-b pb-2 mb-3">Pricing & Policies</h3><div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-2 text-sm">
                                    <div><span class="review-label">MRP:</span> <span id="review-mrp" class="review-value"></span></div>
                                    <div><span class="review-label">Selling Price:</span> <span id="review-selling-price" class="review-value font-bold text-green-600"></span></div>
                                    <div><span class="review-label">Product Weight:</span> <span id="review-product-weight" class="review-value"></span></div>
                                    <div><span class="review-label">Package Weight:</span> <span id="review-package-weight" class="review-value"></span></div>
                                    <div><span class="review-label">Dimensions:</span> <span id="review-package-dimensions" class="review-value"></span></div>
                                    <div><span class="review-label">Package Items:</span> <span id="review-package-items" class="review-value"></span></div>
                                    <div><span class="review-label">Stock:</span> <span id="review-stock" class="review-value"></span></div>
                                    <div><span class="review-label">Return Policy:</span> <span id="review-return-policy" class="review-value"></span></div>
                                    <div id="review-group-buy-container" class="hidden"><span class="review-label">Group Buy Price:</span> <span id="review-group-buy-price" class="review-value"></span></div>
                                    <div id="review-wholesale-container" class="hidden"><span class="review-label">Wholesale Price:</span> <span id="review-wholesale-price" class="review-value"></span></div>
                                </div></div>
                            </div>
                             <div class="mt-8 pt-6 border-t flex justify-between"><button type="button" id="wizard-step5-back" class="bg-gray-200 hover:bg-gray-300 font-semibold py-2 px-5 rounded-lg">← Back</button><button type="button" id="wizard-submit-btn" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-5 rounded-lg shadow">Submit Listing ✅</button></div>
                        </div>
                    </div>
                    
                    <div id="wizard-step-6-success" class="hidden">
                        <div class="text-center py-12">
                            <h2 class="text-4xl font-bold text-green-600 mb-4">Shabaash!</h2>
                            <p class="text-xl text-gray-700 mb-2">Aapka product safaltapoorvak list ho gaya hai.</p>
                            <p class="text-gray-500 mb-8">Verification ke baad yeh buyers ko dikhne lagega.</p>
                            <div class="p-4 bg-yellow-100 rounded-lg">
                                <h3 class="font-bold text-yellow-800">Your First Badge Unlocked! 🏅</h3>
                                <p class="text-sm text-yellow-700">"Pehli Udaan" badge aapke profile mein add ho gaya hai.</p>
                            </div>
                            <div class="mt-8 flex justify-center gap-4">
                                <button class="bg-gray-800 hover:bg-black text-white font-semibold py-2 px-5 rounded-lg">List Another Product</button>
                                <button class="bg-gray-200 hover:bg-gray-300 font-semibold py-2 px-5 rounded-lg">Go to Dashboard</button>
                            </div>
                        </div>
                    </div>

                </div>
             </div>
        </div>
    </div>
    <script>
        function triggerConfetti() {
            confetti({ particleCount: 150, spread: 90, origin: { y: 0.6 } });
        }

        function parseListingText(text) {
            const details = {};
            const lines = text.split('\n').map(line => line.trim()).filter(line => line.length > 0);
        
            let currentKey = '';
            let currentFeatures = [];
            let currentDescription = [];
            let capturingDescription = false;
            let currentPrice = null;
            let currentProductWeight = null;
            let currentPackageWeight = null;
        
            for (const line of lines) {
                if (line.startsWith("Title:")) {
                    details.title = line.replace("Title:", "").trim();
                    currentKey = 'title';
                    capturingDescription = false;
                } else if (line.startsWith("Description:")) {
                    details.description = line.replace("Description:", "").trim();
                    currentKey = 'description';
                    capturingDescription = true;
                } else if (line.startsWith("Material:")) {
                    details.material = line.replace("Material:", "").trim();
                    currentKey = 'material';
                    capturingDescription = false;
                } else if (line.startsWith("Color:")) {
                    details.color = line.replace("Color:", "").trim();
                    currentKey = 'color';
                    capturingDescription = false;
                } else if (line.startsWith("Features:")) {
                    currentKey = 'features';
                    capturingDescription = false;
                } else if (line.startsWith("SEO Keywords:")) {
                    details.keywords = line.replace("SEO Keywords:", "").trim();
                    currentKey = 'keywords';
                    capturingDescription = false;
                } else if (line.startsWith("HSN Code:")) {
                    details.hsnCode = line.replace("HSN Code:", "").trim();
                    currentKey = 'hsnCode';
                    capturingDescription = false;
                } else if (line.startsWith("Suggested Selling Price:")) {
                    const priceMatch = line.match(/₹(\d+)/);
                    if (priceMatch) details.suggestedSellingPrice = priceMatch[1];
                    currentKey = 'suggestedPrice';
                } else if (line.startsWith("Estimated Product Weight:")) {
                    const weightMatch = line.match(/(\d+\.?\d*)\s*KG/i);
                    if (weightMatch) details.estimatedProductWeight = weightMatch[1];
                    currentKey = 'estimatedProductWeight';
                } else if (line.startsWith("Estimated Package Weight:")) {
                    const weightMatch = line.match(/(\d+\.?\d*)\s*KG/i);
                    if (weightMatch) details.estimatedPackageWeight = weightMatch[1];
                    currentKey = 'estimatedPackageWeight';
                } else {
                    if (capturingDescription) {
                        currentDescription.push(line);
                    } else if (currentKey === 'features' && line.startsWith("- ")) {
                        currentFeatures.push(line.replace("- ", "").trim());
                    } else if (currentKey === 'features' && line.length > 0) {
                        currentFeatures.push(line);
                    } else {
                        // Ignore other lines
                    }
                }
            }
        
            if (currentFeatures.length > 0) {
                details.features = currentFeatures.join('\n');
            }
        
            if (currentDescription.length > 0) {
                details.description += '\n' + currentDescription.join('\n');
            }
        
            return details;
        }

        document.addEventListener('DOMContentLoaded', () => {
            // STATE & ELEMENT REFERENCES
            const appState = { currentView: 'wizard', wizardStep: 1 };
            const productData = { images: new Array(4).fill(null) };
            const views = { wizard: document.getElementById('view-product-wizard') };
            const wizardWrapper = document.getElementById('wizard-steps-wrapper');
            const successScreen = document.getElementById('wizard-step-6-success');
            const wizardStepContents = { 1: document.getElementById('wizard-step-1-content'), 2: document.getElementById('wizard-step-2-content'), 3: document.getElementById('wizard-step-3-content'), 4: document.getElementById('wizard-step-4-content'), 5: document.getElementById('wizard-step-5-content') };
            const wizardFileInput = document.getElementById('file-upload-wizard');
            const wizardSlotsContainer = document.getElementById('image-upload-slots');
            
            const BACKEND_URL = "https://banjara-gpt.onrender.com";

            // RENDER FUNCTION
            function render() {
                Object.values(views).forEach(view => view.classList.add('hidden'));
                if (views[appState.currentView]) views[appState.currentView].classList.remove('hidden');
                if (appState.currentView === 'wizard' && !successScreen.classList.contains('hidden')) {
                    wizardWrapper.classList.add('hidden');
                } else if (appState.currentView === 'wizard') {
                    wizardWrapper.classList.remove('hidden');
                    successScreen.classList.add('hidden');
                    for (let i = 1; i <= 5; i++) {
                        const stepEl = document.getElementById(`wp-step-${i}`); if (!stepEl) continue;
                        stepEl.classList.remove('active', 'completed');
                        const dotEl = stepEl.querySelector('.wizard-progress-dot');
                        if (i < appState.wizardStep) { stepEl.classList.add('completed'); dotEl.innerHTML = `&#10003;`; } 
                        else if (i === appState.wizardStep) { stepEl.classList.add('active'); dotEl.textContent = i; } 
                        else { dotEl.textContent = i; }
                    }
                    Object.values(wizardStepContents).forEach(content => content.classList.add('hidden'));
                    if(wizardStepContents[appState.wizardStep]) wizardStepContents[appState.wizardStep].classList.remove('hidden');
                }
            }

            // WIZARD STEP 1: IMAGES
            const renderWizardSlots = () => {
                wizardSlotsContainer.innerHTML = '';
                productData.images.forEach((file, index) => {
                    const slot = document.createElement('div'); slot.className = 'upload-slot';
                    if (file) { slot.innerHTML = `<img src="${URL.createObjectURL(file)}">`; } 
                    else { slot.innerHTML = `<div><span class="text-4xl text-gray-400">+</span><span class="block text-xs mt-1 font-semibold text-gray-500">${index === 0 ? 'Main Image' : `Image ${index + 1}`}</span></div>`; }
                    slot.onclick = () => wizardFileInput.click();
                    wizardSlotsContainer.appendChild(slot);
                });
                const filledSlots = productData.images.filter(f => f !== null).length;
                document.getElementById('wizard-step1-next').disabled = filledSlots < 4;
                document.getElementById('wizard-upload-status').textContent = filledSlots < 4 ? `Please upload ${4 - filledSlots} more image(s).` : '';
            };
            wizardFileInput.addEventListener('change', (e) => {
                const files = Array.from(e.target.files); let filesAdded = 0;
                for (let i = 0; i < productData.images.length && filesAdded < files.length; i++) { if (productData.images[i] === null) productData.images[i] = files[filesAdded++]; }
                renderWizardSlots();
            });

            document.getElementById('wizard-step1-next').addEventListener('click', async () => {
                appState.wizardStep = 2;
                render();

                document.getElementById('ai-image-loader').style.display = 'block';
                document.getElementById('ai-image-results').style.display = 'none';

                const mainImageFile = productData.images[0];
                if (!mainImageFile) {
                    alert("Please upload at least one image to proceed.");
                    appState.wizardStep = 1;
                    render();
                    return;
                }

                document.getElementById('image-before').src = URL.createObjectURL(mainImageFile);

                const formData = new FormData();
                formData.append('file', mainImageFile);

                try {
                    const response = await fetch(`${BACKEND_URL}/upload-listing-image`, {
                        method: 'POST',
                        body: formData,
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    const listingText = data.listing;

                    document.getElementById('image-after').src = URL.createObjectURL(mainImageFile);

                    document.getElementById('ai-image-loader').style.display = 'none';
                    document.getElementById('ai-image-results').style.display = 'block';

                    const parsedDetails = parseListingText(listingText);
                    Object.assign(productData, parsedDetails);

                } catch (error) {
                    console.error("Error during API call or processing:", error);
                    alert("Product details generate karne mein error aaya. Kripya dobara prayas karein. Details ke liye console dekhein.");
                    appState.wizardStep = 1;
                    render();
                    document.getElementById('ai-image-loader').style.display = 'none';
                    document.getElementById('ai-image-results').style.display = 'block';
                }
            });

            // WIZARD STEP 2: AI POLISH (Approval)
            document.getElementById('wizard-step2-back').addEventListener('click', () => { appState.wizardStep = 1; render(); });
            document.getElementById('approve-images-check').addEventListener('change', (e) => { document.getElementById('wizard-step2-next').disabled = !e.target.checked; });
            document.getElementById('wizard-step2-next').addEventListener('click', () => {
                 appState.wizardStep = 3;
                 render();
                 
                 document.getElementById('title').value = productData.title || '';
                 document.getElementById('category').value = productData.category || '';
                 document.getElementById('description').value = productData.description || '';
                 document.getElementById('features').value = productData.features || '';
                 document.getElementById('keywords').value = productData.keywords || '';
                 document.getElementById('material').value = productData.material || '';
                 document.getElementById('color').value = productData.color || '';
                 document.getElementById('hsn-code').value = productData.hsnCode || '';
                 document.getElementById('size-variants').value = productData.sizeVariants || '';
            });

            // WIZARD STEP 3: DETAILS
            document.getElementById('wizard-step3-back').addEventListener('click', () => { appState.wizardStep = 2; render(); });
            document.getElementById('detailsForm').addEventListener('submit', (e) => {
                e.preventDefault();
                Object.assign(productData, {
                    title: document.getElementById('title').value,
                    category: document.getElementById('category').value,
                    description: document.getElementById('description').value,
                    features: document.getElementById('features').value,
                    keywords: document.getElementById('keywords').value,
                    material: document.getElementById('material').value,
                    color: document.getElementById('color').value,
                    hsnCode: document.getElementById('hsn-code').value,
                    sizeVariants: document.getElementById('size-variants').value
                });
                appState.wizardStep = 4; render();
            });

            // WIZARD STEP 4: PRICING
            const mrpInput = document.getElementById('mrp');
            const sellingPriceInput = document.getElementById('sellingPrice');
            const exampleText = document.getElementById('mrp-example-text');
            function updateMrpExample() { const mrp = mrpInput.value || '0'; const sp = sellingPriceInput.value || '0'; exampleText.innerHTML = `Example: <span class="strike">₹${mrp}</span> <span class="final-price">₹${sp}</span>`; }
            mrpInput.addEventListener('input', updateMrpExample); sellingPriceInput.addEventListener('input', updateMrpExample);
            document.getElementById('wizard-step4-back').addEventListener('click', () => { appState.wizardStep = 3; render(); });
            document.getElementById('pricingForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const pricingData = {
                    mrp: document.getElementById('mrp').value,
                    sellingPrice: document.getElementById('sellingPrice').value,
                    productWeight: document.getElementById('product-weight').value,
                    packageWeight: document.getElementById('package-weight').value,
                    packageDimensions: {
                        length: document.getElementById('package-dimensions-length').value,
                        breadth: document.getElementById('package-dimensions-breadth').value,
                        height: document.getElementById('package-dimensions-height').value,
                        unit: document.getElementById('package-dimensions-unit').value
                    },
                    packageItems: document.getElementById('package-items').value,
                    stock: document.getElementById('stock').value,
                    returnPolicy: document.getElementById('return-policy').value
                };
                if (document.getElementById('enable-group-buy').checked) { pricingData.groupBuyPrice = document.getElementById('group-buy-price').value; pricingData.groupBuyMoq = document.getElementById('group-buy-moq').value; }
                if (document.getElementById('enable-wholesale').checked) { pricingData.wholesalePrice = document.getElementById('wholesale-price').value; pricingData.wholesaleMoq = document.getElementById('wholesale-moq').value; }
                Object.assign(productData, pricingData);
                appState.wizardStep = 5;
                populateReviewPage();
                render();
            });

            // WIZARD STEP 5: REVIEW
            document.getElementById('wizard-step5-back').addEventListener('click', () => { appState.wizardStep = 4; render(); });
            const wizardSubmitBtn = document.getElementById('wizard-submit-btn');
            wizardSubmitBtn.addEventListener('click', () => {
                console.log("Final Product Data:", productData);
                wizardWrapper.classList.add('hidden');
                successScreen.classList.remove('hidden');
                triggerConfetti();
            });
            function populateReviewPage() {
                document.getElementById('review-images').innerHTML = productData.images.map(file => file ? `<img src="${URL.createObjectURL(file)}" class="w-full h-auto rounded-md object-cover">` : '').join('');
                document.getElementById('review-title').textContent = productData.title;
                document.getElementById('review-category').textContent = productData.category;
                document.getElementById('review-description').textContent = productData.description;
                document.getElementById('review-material').textContent = productData.material;
                document.getElementById('review-color').textContent = productData.color;
                document.getElementById('review-hsn-code').textContent = productData.hsnCode;
                document.getElementById('review-size-variants').textContent = productData.sizeVariants || 'N/A';
                const featuresList = document.getElementById('review-features');
                featuresList.innerHTML = ''; productData.features.split('\n').forEach(feature => { if (feature.trim()) { const li = document.createElement('li'); li.textContent = feature.trim(); featuresList.appendChild(li); } });
                document.getElementById('review-mrp').textContent = `₹${productData.mrp}`; document.getElementById('review-selling-price').textContent = `₹${productData.sellingPrice}`;

                document.getElementById('review-product-weight').textContent = productData.productWeight ? `${productData.productWeight} KG` : 'N/A';
                document.getElementById('review-package-weight').textContent = productData.packageWeight ? `${productData.packageWeight} KG` : 'N/A';
                if (productData.packageDimensions && productData.packageDimensions.length && productData.packageDimensions.breadth && productData.packageDimensions.height) {
                    document.getElementById('review-package-dimensions').textContent = `${productData.packageDimensions.length} x ${productData.packageDimensions.breadth} x ${productData.packageDimensions.height} ${productData.packageDimensions.unit}`;
                } else {
                    document.getElementById('review-package-dimensions').textContent = 'N/A';
                }
                document.getElementById('review-package-items').textContent = productData.packageItems || 'N/A';

                document.getElementById('review-stock').textContent = `${productData.stock} units`;
                document.getElementById('review-return-policy').textContent = productData.returnPolicy;
                const groupBuyContainer = document.getElementById('review-group-buy-container');
                if (productData.groupBuyPrice) { groupBuyContainer.classList.remove('hidden'); document.getElementById('review-group-buy-price').textContent = `₹${productData.groupBuyPrice} (MOQ: ${productData.groupBuyMoq})`; } else { groupBuyContainer.classList.add('hidden'); }
                const wholesaleContainer = document.getElementById('review-wholesale-container');
                if (productData.wholesalePrice) { wholesaleContainer.classList.remove('hidden'); document.getElementById('review-wholesale-price').textContent = `₹${productData.wholesalePrice} (MOQ: ${productData.wholesaleMoq})`; } else { wholesaleContainer.classList.add('hidden'); }
            }

            // INITIALIZER
            render();
            renderWizardSlots();
            updateMrpExample();
        });
    </script>
</body>
</html>
